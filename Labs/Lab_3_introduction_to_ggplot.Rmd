---
output: html_document
---
### Lab 3 - Data visualisation with ggplot2
##### *February 17, 2016*

--------------------------------------------------------------------------------

##### Etherpad: https://etherpad.wikimedia.org/p/KcLlXgpj6b

* use the text area to post questions or take notes
* use the chat to post when you are done or have questions

--------------------------------------------------------------------------------

##### Learning objectives

1. Explain the difference between categorical and continuous data.

2. Interpret a data table using a meta-data sheet.

4. Use ggplot2 to create a scatterplot that shows the relationship between two 
   variables.

5. Use colours, point size, point shape, and facets to include more than two variables in a ggplot.

--------------------------------------------------------------------------------
    
##### Things to remember

* check your working directory and use the folders you have set up for class
* adhere to a style guide
* comment your code
* Rmarkdown gives you the opportunity for integrating text and code

------------------------------------------------------------------------------

##### Basics - intro to the grammar of graphics

Here is a brief description of the basic building blocks of a creating a ggplot.  

argument        | description of component
--------------- | ------------------------------------------------------------ |
data            | as a data.frame (long format!)
aesthetic (aes) | mapping variables to visualise properties - position, colour, line, type, size |
geom            | actual visualisation of the data |
scale           | map values to the aesthetics, colour, size, shape (show up as legends and axes) |
stat            | statistical transformations, summaries of data (e.g., line fits, etc., ) |
facet           | splitting data across panels based on different subsets of the data |

--------------------------------------------------------------------------------

####Warm-up exercises:  

**1. Using the meta-data on worksheet one of the data file *EST-PR-PlanktonChemTax.xls*, give a brief description (2 - 3 sentences), in your own words, of the plankton data set.**

--------------------------------------------------------------------------------

**2. Also in the meta-data worksheet, you will find a 'Variable Descriptions' section, much like you created for your first lab write-up of the semester. Looking through that and the other information on the meta-data sheet if you need to, identify at least two examples of categorical data and at least two examples of numerical data.**

--------------------------------------------------------------------------------

```{r, echo=FALSE, eval=FALSE}
# Point out ordinal vs. nominal and discrete vs. continuous
```

```{r, warning=FALSE, message=FALSE}
library(readxl)
```
 
Read the plankton data into R and take a look at the structure of the data.

```{r, echo = FALSE, warning=FALSE, message=FALSE, results='hide'}
plankton <- read_excel("Data/EST-PR-PlanktonChemTax.xls", sheet=2)

# Note on looking at warnings
# - part fo the process of understanding our data
```

Confirm that the data matches what you expect it to given the meta-data.

```{r, eval=FALSE}
str(plankton)
```

It is important that we get our data sorted out and checked before plotting. 
While visualisation is a great way to detect problems in your data, it helps 
that you have a decent data.frame to start. Also, by looking at the structure, 
we remind ourselves what the data columns are called.  

--------------------------------------------------------------------------------

**3. Use the function `unique()` to look at the SampleType. What do you notice? How do you think this could cause problems in analysis? Describe some possible solutions to prevent this problem before you get to the step of reading the data into R.**

```{r, warning=FALSE, message=FALSE}
# Install the package dplyr if you have not already done so for this class
#install.packages('dplyr')
library(dplyr)

plankton <- 
  plankton %>% 
  mutate(SampleType = replace(SampleType, SampleType == 'Whole water', 
                              'Wholewater')) %>%
  mutate(SampleType = replace(SampleType, SampleType == '<20' | 
                              SampleType == "< 20 um", '<20um'))
```
--------------------------------------------------------------------------------

One last step. Let's create a subset of the data to work with today to keep 
things more manageable. Create a new object called `plankton_sub` that contains
the first 164 rows of the `plankton` dataset.

```{r}
plankton_sub <- plankton[1:164, ]

# Let's check what dates this covers in the data.
range(plankton_sub$Date)
```

--------------------------------------------------------------------------------

##### Time to plot!

Load the ggplot2 library
```{r, message=FALSE, warning=FALSE}
library(ggplot2)
```

Reminder: We are using the `plankton_sub` dataset!\  

Basic scatterplot

```{r, echo=FALSE, warning=FALSE}
ggplot(data = plankton_sub, aes(x = Temp, y = TotalChlA)) + 
  geom_point()

ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA)) + 
  geom_point()

# Time to talk about what each point represents
```

Adding colour, shape, and size

```{r, echo=FALSE}
ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA)) + 
  geom_point(colour = 'red')

ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA, colour = Site)) + 
  geom_point()
```

```{r, echo = FALSE, eval = FALSE}
# Demonstrating the use of default behaviour
ggplot(data = plankton_sub) + 
  geom_point(aes(x = Date, y = TotalChlA, colour = Site))
```

Shape

```{r, echo=FALSE, warning=FALSE}
ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA)) + 
  geom_point(shape= 21)

# Error message explanation
ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA, shape = Site)) + 
  geom_point()
```

Shape and size

```{r, echo=FALSE}
ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA)) + 
  geom_point(shape= 21, size = 5)
```


Layering

```{r, echo=FALSE}
ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA, by = Site, colour = Site)) + 
  geom_point() + 
  geom_line()

ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA, by = Site, colour = Site)) + 
  geom_point(colour = 'black') + 
  geom_line()

ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA, by = Site, colour = Site)) + 
  geom_line() + 
  geom_point(colour = 'black')
```

**4.Given the examples we have seen, make this plot**

```{r, echo=FALSE}
ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA, by = Site, colour = Site)) + 
  geom_line(colour = 'black') +
  geom_point(size = 3)
```


Colour use differs between discrete and continuous variables
```{r}
ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA, by = Site, colour = Site)) + 
  geom_point()

ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA, by = Site, colour = Site)) + 
  geom_point() + 

```


Facets:

```{r}
ggplot(data = plankton_sub, aes(x = Temp, y = TotalChlA)) + 
  geom_point() + 
  facet_wrap(~ SampleType)

ggplot(data = plankton_sub, aes(x = Temp, y = TotalChlA, colour = Salinity)) + 
  geom_point() + 
  facet_wrap(~ SampleType)
```

--------------------------------------------------------------------------------

**4. Create the following plots and briefly describe what you see.**
```{r, echo = FALSE}
ggplot(data = plankton_sub, aes(x = Distance, y = Salinity)) + 
  geom_point()

ggplot(data = plankton_sub, aes(x = Distance, y = Salinity, colour = Temp)) + 
  geom_point()

ggplot(data = plankton_sub, aes(x = Distance, y = Salinity, colour = Temp)) + 
  geom_point() + 
  scale_colour_gradient(low = "blue", high = "red")

ggplot(data = plankton_sub, aes(x = Distance, y = Temp, colour = Salinity)) + 
  geom_point() + 
  scale_colour_gradient(low = "blue", high = "red")

ggplot(data = plankton_sub, aes(x = Date, y = Temp, colour = Salinity)) + 
  geom_point()

ggplot(data = plankton_sub, aes(x = Date, y = TotalChlA, colour = Salinity, by = Site)) + 
  geom_point() + 
  geom_line()


```


**5. What is the difference between colour and fill?**











